openapi: 3.0.0
info:
  title: Cone Search API
  version: 1.0.0
  description: API endpoints for cone search functionality
servers:
  - url: http://localhost:8000
    description: Development server

paths:
  /search:
    get:
      summary: Display search form page
      description: Renders the search page with both text search and cone search forms
      responses:
        '200':
          description: Search form page rendered successfully
          content:
            text/html:
              schema:
                type: string
      tags:
        - Search

  /search/cone-results:
    post:
      summary: Execute cone search query
      description: |
        Performs a spatial cone search for astronomical objects within a specified region.
        Accepts RA and Dec in either decimal degrees or sexagesimal format, along with a
        search radius and unit selection.
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - ra
                - dec
                - radius
                - radius_unit
              properties:
                ra:
                  type: string
                  description: Right Ascension in decimal degrees or sexagesimal format
                  example: "209.30"
                  examples:
                    sexagesimal:
                      value: "13h57m12.37s"
                      description: Sexagesimal RA format
                    decimal:
                      value: "209.30"
                      description: Decimal degrees RA format
                dec:
                  type: string
                  description: Declination in decimal degrees or sexagesimal format
                  example: "14.48"
                  examples:
                    sexagesimal_positive:
                      value: "+14d28m39.8"
                      description: Sexagesimal Dec format (positive)
                    sexagesimal_negative:
                      value: "-45d30m12s"
                      description: Sexagesimal Dec format (negative)
                    decimal:
                      value: "14.48"
                      description: Decimal degrees Dec format
                radius:
                  type: string
                  description: Search radius value (positive number)
                  example: "0.5"
                radius_unit:
                  type: string
                  description: Unit for the search radius
                  enum: [degrees, arcminutes, arcseconds]
                  example: "arcminutes"
      responses:
        '200':
          description: Search results rendered successfully
          content:
            text/html:
              schema:
                type: string
          headers:
            X-Execution-Time:
              schema:
                type: number
              description: Query execution time in seconds
            X-Result-Count:
              schema:
                type: integer
              description: Number of results returned
            X-Results-Truncated:
              schema:
                type: boolean
              description: Whether results were truncated at 10,000 limit
        '400':
          description: Validation error in form inputs
          content:
            text/html:
              schema:
                type: string
          examples:
            missing_fields:
              value: '<div class="error-message"><p>All fields (RA, Dec, radius) are required</p></div>'
              description: Missing required fields
            invalid_coordinates:
              value: '<div class="error-message"><p>Invalid RA format</p></div>'
              description: Invalid coordinate format
            radius_too_large:
              value: '<div class="error-message"><p>Radius must not exceed 10 degrees</p></div>'
              description: Radius exceeds maximum allowed
      tags:
        - Search

  /api/search/cone:
    post:
      summary: Cone search API endpoint
      description: |
        Programmatic API access to cone search functionality. Returns JSON response
        with search results and metadata.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - ra
                - dec
                - radius
                - radius_unit
              properties:
                ra:
                  type: string
                  description: Right Ascension (decimal degrees or sexagesimal)
                  example: "209.30"
                dec:
                  type: string
                  description: Declination (decimal degrees or sexagesimal)
                  example: "14.48"
                radius:
                  type: number
                  description: Search radius value (positive)
                  example: 0.5
                  minimum: 0
                  maximum: 10
                radius_unit:
                  type: string
                  description: Unit for search radius
                  enum: [degrees, arcminutes, arcseconds]
                  example: "arcminutes"
      responses:
        '200':
          description: Search completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    description: List of astronomical objects found
                    items:
                      type: object
                      properties:
                        source:
                          type: string
                          description: Source identifier
                        ra:
                          type: number
                          description: Right Ascension in degrees
                        dec:
                          type: number
                          description: Declination in degrees
                        epoch:
                          type: number
                          description: Epoch of coordinates
                        equinox:
                          type: string
                          description: Equinox reference
                        shortname:
                          type: string
                          description: Short name for display
                        reference:
                          type: string
                          description: Primary reference
                        other_references:
                          type: string
                          description: Additional references
                        comments:
                          type: string
                          description: Notes and comments
                  total_count:
                    type: integer
                    description: Number of results returned
                  ra_input:
                    type: string
                    description: Original RA input from user
                  dec_input:
                    type: string
                    description: Original Dec input from user
                  radius_value:
                    type: string
                    description: Original radius value from user
                  radius_unit:
                    type: string
                    description: Original radius unit from user
                  execution_time:
                    type: number
                    description: Query execution time in seconds
                  search_time:
                    type: string
                    format: date-time
                    description: Timestamp when search was performed
                  warning:
                    type: string
                    description: Warning message if results were truncated
                    example: "Results limited to 10,000 objects. Refine search to see all results."
          examples:
            successful_search:
              value:
                results:
                  - source: "HIP 65426"
                    ra: 209.301675
                    dec: 14.477722
                    epoch: 2000.0
                    equinox: "J2000"
                    shortname: "HIP 65426"
                    reference: "HIP"
                    other_references: null
                    comments: null
                total_count: 1
                ra_input: "209.30"
                dec_input: "14.48"
                radius_value: "0.5"
                radius_unit: "arcminutes"
                execution_time: 0.123
                search_time: "2024-12-19T10:30:00"
                warning: null
            truncated_results:
              value:
                results: []
                total_count: 10000
                ra_input: "180.0"
                dec_input: "0.0"
                radius_value: "5"
                radius_unit: "degrees"
                execution_time: 2.456
                search_time: "2024-12-19T10:31:00"
                warning: "Results limited to 10,000 objects. Refine search to see all results."
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string
                    description: Error message
          examples:
            missing_fields:
              value:
                detail: "All required fields must be provided: ra, dec, radius, radius_unit"
            invalid_coordinates:
              value:
                detail: "Invalid coordinate format. RA and Dec must be in decimal degrees or sexagesimal format."
            invalid_radius:
              value:
                detail: "Radius must be positive and not exceed 10 degrees after unit conversion."
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string
                    description: Error message
      tags:
        - Search
        - API

components:
  schemas:
    ConeSearchInput:
      type: object
      required:
        - ra
        - dec
        - radius
        - radius_unit
      properties:
        ra:
          type: string
          description: Right Ascension
        dec:
          type: string
          description: Declination
        radius:
          type: string
          description: Search radius value
        radius_unit:
          type: string
          enum: [degrees, arcminutes, arcseconds]
          description: Radius unit
    
    AstronomicalObject:
      type: object
      properties:
        source:
          type: string
          description: Source identifier
        ra:
          type: number
          description: Right Ascension in degrees
        dec:
          type: number
          description: Declination in degrees
        epoch:
          type: number
          description: Epoch of coordinates
        equinox:
          type: string
          description: Equinox reference
        shortname:
          type: string
          description: Short name
        reference:
          type: string
          description: Primary reference
        other_references:
          type: string
          description: Additional references
        comments:
          type: string
          description: Notes and comments

